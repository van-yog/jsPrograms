"use strict";let isPause,interval,speed,scoreGame,cvs=document.querySelector("#canvas"),ctx=cvs.getContext("2d"),btnStartStop=document.querySelector("#btnStartStop"),btnNewGame=document.querySelector("#btnNewGame"),player={},spaceShip=new Image,bgSpace=new Image,crashLine=new Image,blockUp=new Image,blockDown=new Image,life=new Image,block=[],saturn=new Image,planet=[],fly=new Audio,scoreAudio=new Audio,gameOver=new Audio,congratulations=new Audio,backgroundMusic=new Audio;function checkBorders(){player.x+spaceShip.width>=cvs.width&&(player.x=cvs.width-spaceShip.width),player.x<=0&&(player.x=0),player.y<=0&&(player.y=0)}function newGame(){localStorage.setItem("lifes",3),localStorage.setItem("score",0),localStorage.setItem("sumScore","0"),isPause=!0,startPosition(),startGame()}function startPosition(){drawLifes(),drawStatistic(),player={x:10,y:150,gravitation:1},btnStartStop.innerText="Play",location.reload()}function drawLifes(){let e=10,t=cvs.height-50,a=localStorage.getItem("lifes");for(let c=0;c<a;c++)ctx.drawImage(life,e,t),e+=50}function drawStatistic(){let e=Number(localStorage.getItem("sumScore")),t=Number(localStorage.getItem("record"));ctx.fillStyle="#ffd",ctx.font="20px Verdana",ctx.fillText("Record:"+t,cvs.width-130,cvs.height-80),ctx.fillText("Sum: "+e,cvs.width-130,cvs.height-50),ctx.fillText("Score: "+scoreGame,cvs.width-130,cvs.height-20)}function startGame(){drawGameField(),drawLifes(),checkScore(),drawStatistic(),isPause||(backgroundMusic.play(),requestAnimationFrame(startGame))}function checkScore(){let e=0;for(let t=0;t<block.length;t++)block[t].isVisible||e++;if(e>=scoreGame+1){scoreGame++;let e=Number(localStorage.getItem("sumScore"))+1;localStorage.setItem("sumScore",e),scoreAudio.play()}}function drawGameField(){ctx.drawImage(bgSpace,0,0);for(let e=0;e<block.length;e++){if(replaceBlock(e),birdCrash(e))return ctx.drawImage(crashLine,0,cvs.height-crashLine.height),drawLifes(),drawStatistic(),startPosition();let t=block[e].x;75==t&&createNewBlock(),t+blockUp.width<=0&&(block[e].isVisible=!1)}ctx.drawImage(spaceShip,player.x,player.y),ctx.drawImage(crashLine,0,cvs.height-crashLine.height),player.y+=player.gravitation}function replaceBlock(e){let t=planet[e].x,a=planet[e].y;ctx.drawImage(saturn,t,a),planet[e].x--;let c=block[e].x,r=block[e].y,o=block[e].y+blockUp.height+interval;ctx.drawImage(blockUp,c,r),ctx.drawImage(blockDown,c,o),block[e].x-=speed}function createNewBlock(){block.push({x:cvs.width,y:Math.floor(Math.random()*blockUp.height)-blockUp.height,isVisible:!0}),planet.push({x:3*Math.floor(Math.random()*cvs.width),y:Math.floor(Math.random()*cvs.height)}),block.length%4||speed++}function birdCrash(e){let t=block[e].x,a=block[e].y,c=player.x+spaceShip.width>=t,r=player.x<=t+blockUp.width;return c&&r&&(player.y<=a+blockUp.height||player.y+spaceShip.height>=a+blockUp.height+interval)?(endOfLife(),!0):player.y+spaceShip.height>=cvs.height-crashLine.height?(endOfLife(),!0):void 0}function endOfLife(){backgroundMusic.pause();let e=Number(localStorage.getItem("lifes"))-1;localStorage.setItem("lifes",e),0===e&&(gameOver.play(),ctx.drawImage(crashLine,0,cvs.height-crashLine.height),drawLifes(),drawStatistic(),alert("Game Over"),checkRecord(),newGame())}function setStartProperties(){isPause=!0,localStorage.lifes||localStorage.setItem("lifes",3),localStorage.record||localStorage.setItem("record",0),localStorage.sumScore||localStorage.setItem("sumScore",0),console.log(localStorage),spaceShip.src="./src/img/spaceship1.png",bgSpace.src="./src/img/bgSpace.png",crashLine.src="./src/img/crashLine.png",blockUp.src="./src/img/blockUp.png",blockDown.src="./src/img/blockDown.png",life.src="./src/img/life.png",saturn.src="./src/img/saturn.png",createNewBlock(),player={x:10,y:150,gravitation:1},fly.src="./src/audio/rocket.mp3",scoreAudio.src="./src/audio/score.mp3",backgroundMusic.src="./src/audio/backgroundMusic.mp3",congratulations.src="./src/audio/congratulations.mp3",gameOver.src="./src/audio/gameOver.mp3",interval=130,speed=1,scoreGame=0}function moveUp(){isPause||(player.y-=10,fly.play())}function checkRecord(){let e=Number(localStorage.getItem("record")),t=Number(localStorage.getItem("sumScore"));e<t&&(congratulations.play(),alert(`Congratulations! New record : ${t}`),localStorage.setItem("record",t))}setStartProperties(),blockDown.onload=startGame,btnStartStop.addEventListener("click",()=>{let e=btnStartStop.innerText;isPause="Pause"===e,btnStartStop.innerText="Pause"===e?"Play":"Pause",startGame()}),btnNewGame.addEventListener("click",newGame),cvs.addEventListener("click",moveUp),document.body.addEventListener("keypress",e=>{isPause||("d"===e.key&&(player.x+=5),"a"===e.key&&(player.x-=5),"s"===e.key&&(player.y+=5),"w"===e.key&&(player.y-=15,fly.play()),checkBorders())});