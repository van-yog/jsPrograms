"use strict";let isPause,interval,speed,scoreGame,cvs=document.querySelector("#canvas"),ctx=cvs.getContext("2d"),btnStartStop=document.querySelector("#btnStartStop"),btnNewGame=document.querySelector("#btnNewGame"),player={},spaceShip=new Image,bgSpace=new Image,crashLine=new Image,blockUp=new Image,blockDown=new Image,life=new Image,block=[],saturn=new Image,earth=new Image,moon=new Image,star=new Image,asteroid=new Image,planet={},planet1={},fly=new Audio,scoreAudio=new Audio,gameOver=new Audio,congratulations=new Audio,backgroundMusic=new Audio;function checkBorders(){player.x+spaceShip.width>=cvs.width&&(player.x=cvs.width-spaceShip.width),player.x<=0&&(player.x=0),player.y<=0&&(player.y=0)}function newGame(){localStorage.setItem("lifes",3),localStorage.setItem("score",0),localStorage.setItem("sumScore","0"),isPause=!0,startPosition(),startGame()}function startPosition(){drawLifes(),drawStatistic(),player={x:10,y:150,gravitation:1},btnStartStop.innerText="Play",location.reload()}function drawLifes(){let e=10,t=cvs.height-50,a=localStorage.getItem("lifes");for(let r=0;r<a;r++)ctx.drawImage(life,e,t),e+=50}function drawStatistic(){let e=Number(localStorage.getItem("sumScore")),t=Number(localStorage.getItem("record"));ctx.fillStyle="#ffd",ctx.font="20px Verdana",ctx.fillText("Record:"+t,cvs.width-130,cvs.height-80),ctx.fillText("Sum: "+e,cvs.width-130,cvs.height-50),ctx.fillText("Score: "+scoreGame,cvs.width-130,cvs.height-20)}function startGame(){drawGameField(),drawLifes(),checkScore(),drawStatistic(),isPause||(backgroundMusic.play(),requestAnimationFrame(startGame))}function checkScore(){let e=0;for(let t=0;t<block.length;t++)block[t].isVisible||e++;if(e>=scoreGame+1){scoreGame++;let e=Number(localStorage.getItem("sumScore"))+1;localStorage.setItem("sumScore",e),scoreAudio.play()}}function drawGameField(){ctx.drawImage(bgSpace,0,0),drawPlanets();for(let e=0;e<block.length;e++){if(replaceBlock(e),birdCrash(e))return ctx.drawImage(crashLine,0,cvs.height-crashLine.height),drawLifes(),drawStatistic(),startPosition();let t=block[e].x;75==t&&createNewBlock(),t+blockUp.width<=0&&(block[e].isVisible=!1)}ctx.drawImage(spaceShip,player.x,player.y),ctx.drawImage(crashLine,0,cvs.height-crashLine.height),player.y+=player.gravitation}function drawPlanets(){if(planet.x>-60)ctx.drawImage(planet.name,planet.x--,planet.y);else{planet.y=Math.floor(Math.random()*(cvs.height-crashLine.height)),planet.x=375+Math.round(Math.random()*cvs.width/2);let e=Math.round(4*Math.random());console.log(e),planet.name=planet.arr[e]}if(planet1.x>-60)ctx.drawImage(planet1.name,planet1.x--,planet1.y);else{planet1.y=Math.floor(Math.random()*(cvs.height-crashLine.height)),planet1.x=375+Math.round(Math.random()*cvs.width/2);let e=Math.round(4*Math.random());console.log(e),planet1.name=planet1.arr[e]}}function replaceBlock(e){let t=block[e].x,a=block[e].y,r=block[e].y+blockUp.height+interval;ctx.drawImage(blockUp,t,a),ctx.drawImage(blockDown,t,r),block[e].x-=speed}function createNewBlock(){block.push({x:cvs.width,y:Math.floor(Math.random()*blockUp.height)-blockUp.height,isVisible:!0}),3==block.length&&speed++,8==block.length&&speed++,12==block.length&&speed++,16==block.length&&speed++}function birdCrash(e){let t=block[e].x,a=block[e].y,r=player.x+spaceShip.width>=t,c=player.x<=t+blockUp.width;return r&&c&&(player.y<=a+blockUp.height||player.y+spaceShip.height>=a+blockUp.height+interval)?(endOfLife(),!0):player.y+spaceShip.height>=cvs.height-crashLine.height?(endOfLife(),!0):void 0}function endOfLife(){backgroundMusic.pause();let e=Number(localStorage.getItem("lifes"))-1;localStorage.setItem("lifes",e),0===e&&(gameOver.play(),ctx.drawImage(crashLine,0,cvs.height-crashLine.height),drawLifes(),drawStatistic(),alert("Game Over"),checkRecord(),newGame())}function setStartProperties(){isPause=!0,localStorage.lifes||localStorage.setItem("lifes",3),localStorage.record||localStorage.setItem("record",0),localStorage.sumScore||localStorage.setItem("sumScore",0),console.log(localStorage),spaceShip.src="./src/img/spaceship1.png",bgSpace.src="./src/img/bgSpace.png",crashLine.src="./src/img/crashLine.png",blockUp.src="./src/img/blockUp.png",blockDown.src="./src/img/blockDown.png",life.src="./src/img/life.png",saturn.src="./src/img/saturn.png",earth.src="./src/img/earth.png",moon.src="./src/img/moon.png",star.src="./src/img/star.png",asteroid.src="./src/img/asteroid.png",planet.arr=[saturn,earth,moon,star,asteroid],planet.x=375+Math.round(Math.random()*cvs.width/2),planet.y=Math.round(Math.random()*(cvs.height-crashLine.height));let e=Math.round(4*Math.random());planet.name=planet.arr[e],planet1.arr=[saturn,earth,moon,star,asteroid],planet1.x=450+Math.round(Math.random()*cvs.width/2),planet1.y=Math.round(Math.random()*(cvs.height-crashLine.height)),e=Math.round(4*Math.random()),planet1.name=planet1.arr[e],createNewBlock(),player={x:10,y:150,gravitation:1},fly.src="./src/audio/rocket.mp3",scoreAudio.src="./src/audio/score.mp3",backgroundMusic.src="./src/audio/backgroundMusic.mp3",congratulations.src="./src/audio/congratulations.mp3",gameOver.src="./src/audio/gameOver.mp3",interval=130,speed=1,scoreGame=0}function moveUp(){isPause||(player.y-=10,fly.play())}function checkRecord(){let e=Number(localStorage.getItem("record")),t=Number(localStorage.getItem("sumScore"));e<t&&(congratulations.play(),alert(`Congratulations! New record : ${t}`),localStorage.setItem("record",t))}setStartProperties(),blockDown.onload=startGame,btnStartStop.addEventListener("click",()=>{let e=btnStartStop.innerText;isPause="Pause"===e,btnStartStop.innerText="Pause"===e?"Play":"Pause",startGame()}),btnNewGame.addEventListener("click",newGame),cvs.addEventListener("click",moveUp),document.body.addEventListener("keypress",e=>{isPause||("d"===e.key&&(player.x+=5),"a"===e.key&&(player.x-=5),"s"===e.key&&(player.y+=5),"w"===e.key&&(player.y-=15,fly.play()),checkBorders())});